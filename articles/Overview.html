<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nanostringr">
<title>nanostringr Package • nanostringr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="nanostringr Package">
<meta property="og:description" content="nanostringr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nanostringr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Overview.html">nanostringr Package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/TalhoukLab/nanostringr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>nanostringr Package</h1>
            
            <h4 data-toc-skip class="date">2023-08-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/TalhoukLab/nanostringr/blob/HEAD/vignettes/Overview.Rmd" class="external-link"><code>vignettes/Overview.Rmd</code></a></small>
      <div class="d-none name"><code>Overview.Rmd</code></div>
    </div>

    
    
<p>The <code>nanostringr</code> R package is a companion R package to
the manuscript:</p>
<p>A. Talhouk, S. Kommoss, R. Mackenzie, M. Cheung, S. Leung, D. Chiu,
S. Kalloger, D. Huntsman, S. Chen, M. Intermaggio, J. Gronwald, F. Chan,
S. Ramus, C. Steidl, D. Scott, M. Anglesio. (2016). Single-patient
molecular testing with NanoString nCounter Data using a reference-based
strategy for batch effect correction. <em>PLos ONE</em>.</p>
<p>This vignette provides a guide to reproduce the analyses in the paper
and document the use of some of the functions.</p>
<div class="section level2">
<h2 id="the-data">The Data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h2>
<p>Included in this package are several datasets that are described in
detail in the manuscript and that are annotated in expQC, the annotation
data frame for all of the experiments, run in different CodeSets,
including:</p>
<ul>
<li>
<strong>Hodgkin Lymphoma Clinical Samples (HL)</strong> TOTAL 74
samples
<ul>
<li>HL1 n=32 Unique Samples</li>
<li>HL2 n=32 Replicates of HL1 samples</li>
<li>HL3 n=10 Replicates (subset of HL1 samples)</li>
</ul>
</li>
<li>
<strong>Ovarian Cancer Clinical Samples (OC)</strong> TOTAL 258
samples
<ul>
<li>OC1 n=129 Unique</li>
<li>OC2 n=129 Replicates of OC1 samples</li>
</ul>
</li>
<li>
<strong>Ovarian Cancer Cell Lines (OVCL)</strong> TOTAL 26 samples
<ul>
<li>OC1 n=13 Unique</li>
<li>OC2 n=13 Replicates of OC1 samples</li>
</ul>
</li>
<li>
<strong>DNA Oligonucleotides for the HL CodeSet (HLO)</strong> TOTAL
68 HLO pool run at different concentrations
<ul>
<li>HL1 n=36<br>
</li>
<li>HL2 n=30<br>
</li>
<li>HL3 n=2</li>
</ul>
</li>
<li>
<strong>DNA Oligonucleotides for the OC CodeSet (OVO)</strong> TOTAL
135 OVO pool run at different concentrations
<ul>
<li>OC1 n=47<br>
</li>
<li>OC2 n=88</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="the-functions">The Functions<a class="anchor" aria-label="anchor" href="#the-functions"></a>
</h2>
<div class="section level3">
<h3 id="nanostringqc">NanoStringQC<a class="anchor" aria-label="anchor" href="#nanostringqc"></a>
</h3>
<p>The NanoStringQC function computes several QC metrics and appends
them to the annotation matrix. Care should be taken to ensure that the
data is in the proper format. The function returns different QC metric
flags that can be used to filter out samples that fail QC.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TalhoukLab/nanostringr/" class="external-link">nanostringr</a></span><span class="op">)</span></span>
<span><span class="va">expOVD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NanoStringQC.html">NanoStringQC</a></span><span class="op">(</span><span class="va">ovd.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">expQC</span>, <span class="va">OVD</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">expOVO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NanoStringQC.html">NanoStringQC</a></span><span class="op">(</span><span class="va">ovo.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">expQC</span>, <span class="va">OVO</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">expOVCL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NanoStringQC.html">NanoStringQC</a></span><span class="op">(</span><span class="va">ovc.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">expQC</span>, <span class="va">OVCL</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">expHLD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NanoStringQC.html">NanoStringQC</a></span><span class="op">(</span><span class="va">hld.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">expQC</span>, <span class="va">HLD</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">expHLO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NanoStringQC.html">NanoStringQC</a></span><span class="op">(</span><span class="va">hlo.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">expQC</span>, <span class="va">HLO</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">expQC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">expHLD</span>, <span class="va">expOVD</span>, <span class="va">expHLO</span>, <span class="va">expOVO</span>, <span class="va">expOVCL</span><span class="op">)</span></span>
<span><span class="va">expQC</span><span class="op">$</span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"HLD"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">expHLD</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"OVD"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">expOVD</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"HLO"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">expHLO</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"OVO"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">expOVO</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"OVCL"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">expOVCL</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HLD"</span>, <span class="st">"OVD"</span>, <span class="st">"OVCL"</span>, <span class="st">"HLO"</span>, <span class="st">"OVO"</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HL"</span>, <span class="st">"OC"</span>, <span class="st">"OVCL"</span>, <span class="st">"HLO"</span>, <span class="st">"OVO"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="metrics-for-quality-assurance">Metrics for Quality Assurance<a class="anchor" aria-label="anchor" href="#metrics-for-quality-assurance"></a>
</h4>
</div>
<div class="section level4">
<h4 id="fields-of-view-fov">Fields Of View (FOV)<a class="anchor" aria-label="anchor" href="#fields-of-view-fov"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">perFOV</span> <span class="op">~</span> <span class="va">cohort</span>, ylab <span class="op">=</span> <span class="st">"% FOV"</span>, main <span class="op">=</span> <span class="st">"% FOV by Cohort"</span>, data <span class="op">=</span> <span class="va">expQC</span>, pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">COL.HLD</span>, <span class="va">COL.OVD</span>, <span class="va">COL.OVCL</span>, <span class="va">COL.HLO</span>, <span class="va">COL.OVO</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">75</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Overview_files/figure-html/perFOVPlot-1.png" alt="Samples that failed imaging QC based on percent fields of view (FOV) counted across cohorts." width="672"><p class="caption">
Samples that failed imaging QC based on percent fields of view (FOV)
counted across cohorts.
</p>
</div>
</div>
<div class="section level4">
<h4 id="positive-controls">Positive Controls<a class="anchor" aria-label="anchor" href="#positive-controls"></a>
</h4>
<div class="section level5">
<h5 id="linearity-of-positive-controls">Linearity of Positive Controls<a class="anchor" aria-label="anchor" href="#linearity-of-positive-controls"></a>
</h5>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">linPC</span> <span class="op">~</span> <span class="va">cohort</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">R</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Linearity of Positive Controls by Cohort"</span>,</span>
<span>        data <span class="op">=</span> <span class="va">expQC</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">COL.HLD</span>, <span class="va">COL.OVD</span>, <span class="va">COL.OVCL</span>, <span class="va">COL.HLO</span>, <span class="va">COL.OVO</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0.95</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Overview_files/figure-html/linPCPlot-1.png" alt="Plot of $R^2$ of positive control probes from samples across all cohorts." width="672"><p class="caption">
Plot of <span class="math inline">\(R^2\)</span> of positive control
probes from samples across all cohorts.
</p>
</div>
</div>
</div>
<div class="section level4">
<h4 id="signal-to-noise-ratio-snr">Signal to Noise Ratio (SNR)<a class="anchor" aria-label="anchor" href="#signal-to-noise-ratio-snr"></a>
</h4>
<div class="section level5">
<h5 id="level-of-housekeeping-genes">Level of Housekeeping Genes<a class="anchor" aria-label="anchor" href="#level-of-housekeeping-genes"></a>
</h5>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">averageHK</span> <span class="op">~</span> <span class="va">cohort</span>, ylab <span class="op">=</span> <span class="st">"Average log HK expression"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Average log expression of Housekeeping genes by Cohort"</span>, data <span class="op">=</span> <span class="va">expQC</span>, pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">COL.HLD</span>, <span class="va">COL.OVD</span>, <span class="va">COL.OVCL</span>, <span class="va">COL.HLO</span>, <span class="va">COL.OVO</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">50</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Overview_files/figure-html/averageHKPlot-1.png" alt="Average log expression of Housekeeping genes by Cohort." width="672"><p class="caption">
Average log expression of Housekeeping genes by Cohort.
</p>
</div>
</div>
<div class="section level5">
<h5 id="limit-of-detection-lod">Limit of Detection (LOD)<a class="anchor" aria-label="anchor" href="#limit-of-detection-lod"></a>
</h5>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">lod</span> <span class="op">~</span> <span class="va">cohort</span>, ylab <span class="op">=</span> <span class="st">"LOD"</span>, main <span class="op">=</span> <span class="st">"Limit of detection (LOD) by Cohort"</span>,</span>
<span>        data <span class="op">=</span> <span class="va">expQC</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">COL.HLD</span>, <span class="va">COL.OVD</span>, <span class="va">COL.OVCL</span>, <span class="va">COL.HLO</span>, <span class="va">COL.OVO</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">50</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Overview_files/figure-html/lodPlot-1.png" alt="Limit of detection by cohort." width="672"><p class="caption">
Limit of detection by cohort.
</p>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">pergd</span> <span class="op">~</span> <span class="va">cohort</span>, data <span class="op">=</span> <span class="va">expQC</span>, border <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"% Genes Detected"</span>, </span>
<span>       main <span class="op">=</span> <span class="st">"Percent of Genes Detected Above \n the Limit of Detection"</span>, </span>
<span>       pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">COL.HLD</span>, <span class="va">COL.OVD</span>, <span class="va">COL.OVCL</span>, <span class="va">COL.HLO</span>, <span class="va">COL.OVO</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">50</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/stripchart.html" class="external-link">stripchart</a></span><span class="op">(</span><span class="va">pergd</span> <span class="op">~</span> <span class="va">cohort</span>, data <span class="op">=</span> <span class="va">expQC</span>, </span>
<span>           vertical <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="st">"jitter"</span>,  </span>
<span>           pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">0.4</span> , col <span class="op">=</span> <span class="st">"#3A6EE3"</span>, </span>
<span>           add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
<div class="figure">
<img src="Overview_files/figure-html/pergdPlot-1.png" alt="Percent genes of total (excluding controls) detected above the limit of detection." width="672"><p class="caption">
Percent genes of total (excluding controls) detected above the limit of
detection.
</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sn</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">detect</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">expOVD</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expOVD</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.OVD</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">expOVD</span><span class="op">$</span><span class="va">sn</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Signal to Noise Ratio"</span>, ylab <span class="op">=</span> <span class="st">"% Genes Detected"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">expOVO</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expOVO</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.OVO</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">expOVCL</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expOVCL</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.OVCL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">expHLD</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expHLD</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.HLD</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">expHLO</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expHLO</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.HLO</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">expQC</span><span class="op">$</span><span class="va">sn</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">sn</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">detect</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Signal to Noise vs \n Ratio of Genes Detected"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HL"</span>, <span class="st">"OC"</span>, <span class="st">"OVCL"</span>, <span class="st">"HLO"</span>, <span class="st">"OVO"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, bty <span class="op">=</span> <span class="st">'n'</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">COL.HLD</span>, <span class="va">COL.OVD</span>, <span class="va">COL.OVCL</span>, <span class="va">COL.HLO</span>, <span class="va">COL.OVO</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Overview_files/figure-html/snPlot-1.png" alt="Signal to Noise versus % Gene Detected by cohort." width="672"><p class="caption">
Signal to Noise versus % Gene Detected by cohort.
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">expOVD</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expOVD</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.OVD</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6000</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Signal to Noise Ratio "</span>, ylab <span class="op">=</span> <span class="st">"Ratio of Genes Detected"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">expOVO</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expOVO</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.OVO</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">expOVCL</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expOVCL</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.OVCL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">expHLD</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expHLD</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.HLD</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">expHLO</span><span class="op">$</span><span class="va">sn</span>, <span class="va">expHLO</span><span class="op">$</span><span class="va">pergd</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="va">COL.HLO</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">expQC</span><span class="op">$</span><span class="va">sn</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">sn</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">detect</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Signal to Noise vs \n Ratio of Genes Detected (Zooming-in)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HL"</span>, <span class="st">"OC"</span>, <span class="st">"OVCL"</span>, <span class="st">"HLO"</span>, <span class="st">"OVO"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, bty <span class="op">=</span> <span class="st">'n'</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">COL.HLD</span>, <span class="va">COL.OVD</span>, <span class="va">COL.OVCL</span>, <span class="va">COL.HLO</span>, <span class="va">COL.OVO</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Overview_files/figure-html/snZoom-1.png" alt="Signal to Noise versus % Gene Detected by cohort zoomed in to the area of possible failures." width="672"><p class="caption">
Signal to Noise versus % Gene Detected by cohort zoomed in to the area
of possible failures.
</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="hknorm">HKnorm<a class="anchor" aria-label="anchor" href="#hknorm"></a>
</h3>
<p>The HKnorm function does a simple normalization to log transformed
(base 2) gene expression data data to housekeeping genes. This is done
by subtracting the average log housekeeping gene expression level from
the expression level of every gene in each sample.</p>
<p>As an example, here we check the QC metrics of the Hodgkin Lymphoma
data and normalize it to housekeeping genes:</p>
<p>We can check to see if any samples failed QC metrics</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expHLD0</span> <span class="op">&lt;-</span> <span class="va">expHLD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">expHLD0</span><span class="op">$</span><span class="va">QCFlag</span> <span class="op">==</span> <span class="st">"Failed"</span><span class="op">)</span></span></code></pre></div>
<p>[1] TRUE</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expHLD0</span><span class="op">$</span><span class="va">sampleID</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">expHLD0</span><span class="op">$</span><span class="va">QCFlag</span> <span class="op">==</span> <span class="st">"Failed"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>[1] “HL1_3” “HL1_13” “HL1_17” “HL1_18” “HL2_3”</p>
<p>Since these are matched samples we must remove both pairs from the
annotation data frame and from the gene expression data frame.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expHLD</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">expHLD0</span>, <span class="va">sampleID</span> <span class="op">!=</span> <span class="st">"HL1_18"</span> <span class="op">&amp;</span> <span class="va">sampleID</span> <span class="op">!=</span> <span class="st">"HL2_18"</span><span class="op">)</span></span>
<span><span class="va">hld</span> <span class="op">&lt;-</span> <span class="va">hld.r</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hld.r</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HL1_18"</span>, <span class="st">"HL2_18"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We now normalize the resulting gene expression data</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If data already log normalized</span></span>
<span><span class="va">hld.n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HKnorm.html">HKnorm</a></span><span class="op">(</span><span class="va">hld</span>, is.logged <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Otherwise, normalize to HK </span></span>
<span><span class="va">hld.n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HKnorm.html">HKnorm</a></span><span class="op">(</span><span class="va">hld</span><span class="op">)</span></span>
<span><span class="va">hld1</span> <span class="op">&lt;-</span> <span class="va">hld.n</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"HL1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hld.n</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">exp.hld1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">expHLD</span>, <span class="va">geneRLF</span> <span class="op">==</span> <span class="st">"HL1"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hld2</span> <span class="op">&lt;-</span> <span class="va">hld.n</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"HL2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hld.n</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">exp.hld2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">expHLD</span>, <span class="va">geneRLF</span> <span class="op">==</span> <span class="st">"HL2"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="refmethod">refMethod<a class="anchor" aria-label="anchor" href="#refmethod"></a>
</h3>
<p>This function does batch adjustment using a reference-based
strategy.</p>
<p>Below is how this would work for the HL data:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># The number of references to use</span></span>
<span><span class="va">choice.refs</span> <span class="op">&lt;-</span> <span class="va">exp.hld1</span><span class="op">$</span><span class="va">sampleID</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">exp.hld1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">r</span>, replace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">]</span> <span class="co"># select reference samples randomly</span></span>
<span><span class="va">R1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">hld1</span><span class="op">[</span>, <span class="va">choice.refs</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">R2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">hld2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"HL2"</span>, <span class="fu">getNum</span><span class="op">(</span><span class="va">choice.refs</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">hld2</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hld2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"HL2"</span>, <span class="fu">getNum</span><span class="op">(</span><span class="va">choice.refs</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">S2.r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="../reference/refMethod.html">refMethod</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">R1</span>, <span class="va">R2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Data from CodeSet 2 now calibrated for CodeSet 1</span></span></code></pre></div>
<p>We can check the result by selecting a random gene and plotting the
expression values from both CodeSets</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2016</span><span class="op">)</span></span>
<span><span class="va">gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hld1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">hld1</span><span class="op">[</span><span class="va">gene</span>, <span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">hld2</span><span class="op">[</span><span class="va">gene</span>, <span class="op">]</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"HL1"</span>, ylab <span class="op">=</span> <span class="st">"HL2"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"No Correction"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">hld1</span><span class="op">[</span><span class="va">gene</span>, <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hld1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">choice.refs</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">S2.r</span><span class="op">[</span><span class="va">gene</span>, <span class="op">]</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"HL1"</span>, ylab <span class="op">=</span> <span class="st">"HL2"</span>, main <span class="op">=</span> <span class="st">"Corrected"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/plot_gene-1.png" width="672"></p>
<!-- # Downstream Analysis -->
<!-- In the previous analysis we compared the gene expression value of an individual gene. Below is the impact on a downstream analysis. We use the HL prognostic model as an example. For additional information on this model, the reader is referred to the [paper](http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0153844). -->
<!-- ```{r downstream_analysis} -->
<!-- library(CHL26predictor) -->
<!-- # We select the genes that are used in the model -->
<!-- CHL26.HL1.exprs <- hld.n[rownames(hld.n) %in% CHL26.model.coef.df$geneName, -->
<!--                          grep("HL1", colnames(hld.n))] + log(1000, 2) -->
<!-- CHL26.HL2.exprs <- hld.n[rownames(hld.n) %in% CHL26.model.coef.df$geneName, -->
<!--                          grep("HL2", colnames(hld.n))] + log(1000, 2) -->
<!-- # This is the threshold -->
<!-- risk.thres <- 0.6235 -->
<!-- n <- dim(CHL26.HL1.exprs)[2] -->
<!-- # We compute the risk scores in each CodeSet -->
<!-- scores.df1 <- get_CHL26_scores(as.matrix(CHL26.HL1.exprs)) -->
<!-- scores.df2 <- get_CHL26_scores(as.matrix(CHL26.HL2.exprs)) -->
<!-- scores.risk.df1 <- scores.df1 %>% -->
<!--   mutate(riskClass = ifelse(score >= risk.thres, "High", "Low")) -->
<!-- scores.risk.df2 <- scores.df2 %>% -->
<!--   mutate(riskClass = ifelse(score >= risk.thres, "High", "Low")) -->
<!-- # We assess how many cases are misclassified -->
<!-- tabRisk <- table(scores.risk.df1$riskClass, scores.risk.df2$riskClass) -->
<!-- ind.mis <- which(scores.risk.df1$riskClass != scores.risk.df2$riskClass) -->
<!-- mis <- n - sum(diag(tabRisk)) -->
<!-- ``` -->
<!-- ```{r RawScores, message = FALSE, echo = FALSE, warning = FALSE} -->
<!-- CCplot(scores.risk.df1$score, scores.risk.df2$score, Ptype = "scatter", -->
<!--        xrange = range(scores.df1$score), yrange = range(scores.df2$score), -->
<!--        xlabel = "HL1", ylabel = "HL2", subtitle = "Scores without Batch Adjustment") -->
<!-- abline(h = risk.thres, col = 2, lty = 1) -->
<!-- text(0.7, 0.58, paste("Misclassified:", mis), col = "red") -->
<!-- points(scores.risk.df1$score[ind.mis], scores.risk.df2$score[ind.mis], col = "red") -->
<!-- ``` -->
<!-- ```{r BootStrapped, message = FALSE, echo = FALSE, warning = FALSE, cache = TRUE} -->
<!-- set.seed(40) -->
<!-- r <- 3  # Number of reference samples -->
<!-- nB <- 1500  # of bootstrap samples -->
<!-- nth <- 1000 -->
<!-- misCount <- rep(0, nB) -->
<!-- ind.mis.count <- rep(0, nB) -->
<!-- Cmetrix <- matrix(0, nrow = nB, ncol = 3) -->
<!-- for (i in 1:nB) { -->
<!--   choice.refs <- exp.hld1$sampleID[sample((1:dim(exp.hld1)[1]), r, replace = F)]  # select reference samples randomly -->
<!--   DSR1 <- t(hld1[, choice.refs] + log2(1000)) -->
<!--   DSR2 <- t(hld2[, paste("HL2", getNum(choice.refs), sep = "_")] + log2(1000)) -->
<!--   DSY <- t(hld2[, !colnames(hld2) %in% paste("HL2", getNum(choice.refs), sep = "_")] + log2(1000)) -->
<!--   DSS2.r <- t(refMethod(DSY, DSR1, DSR2)) -->
<!--   CHL26.HL2.r.SS.exprs <- DSS2.r[rownames(DSS2.r) %in% CHL26.model.coef.df$geneName, ] -->
<!--   scores.ss.df2.r <- get_CHL26_scores(as.matrix(CHL26.HL2.r.SS.exprs)) -->
<!--   scores.risk.ss.df2.r <- scores.ss.df2.r %>% -->
<!--     mutate(riskClass = ifelse(score >= risk.thres, "High", "Low")) -->
<!--   ndx2.r <- substring(scores.df1$sampleID, 5) %in% substring(scores.ss.df2.r$sampleID, 5) -->
<!--   misCount[i] <- (n - r) - sum(diag(table(scores.risk.df1$riskClass[ndx2.r], -->
<!--                                           scores.risk.ss.df2.r$riskClass))) -->
<!--   ind.mis.t <- scores.risk.ss.df2.r$sampleID[which(scores.risk.df1$riskClass[ndx2.r] != scores.risk.ss.df2.r$riskClass)] -->
<!--   ind.mis.count[i] <- (sum(ind.mis.t %in% c("HL2_30", "HL2_32")) == misCount[i]) -->
<!--   Cmetrix[i, ] <- CCplot(scores.df1$score[ndx2.r], scores.risk.ss.df2.r$score, metrics = TRUE) -->
<!--   if (i %% nth == 0) { -->
<!--     CCplot(scores.df1$score[ndx2.r], scores.risk.ss.df2.r$score, Ptype = "scatter", -->
<!--            xrange = range(scores.df1$score), yrange = range(scores.df2$score), -->
<!--            xlabel = "HL1", ylabel = "HL2") -->
<!--     abline(h = risk.thres, col = 2, lty = 1) -->
<!--     text(0.7, 0.58, paste("Misclassified:", misCount[i]), col = "red") -->
<!--   } -->
<!-- } -->
<!-- TotalMisCount <- table(misCount) / nB -->
<!-- Accuracy <- Cmetrix[, 2] -->
<!-- knitr::kable(data.frame(table(Accuracy))) -->
<!-- if (length(TotalMisCount) > 3) { -->
<!--   print("more than 3 misclassifications observed") -->
<!-- } -->
<!-- ``` -->
<!-- Another visualization to assess concordance correlation is the Bland-Altman plot or the MA plot: -->
<!-- ```{r MAplot, echo=FALSE} -->
<!-- Metrics <- CCplot(scores.risk.df1$score, scores.risk.df2$score, -->
<!--                   Ptype = "MAplot", -->
<!--                   xrange = range(scores.df1$score), -->
<!--                   yrange = range(scores.df2$score), -->
<!--                   xlabel = "HL1", ylabel = "HL2", metrics = TRUE) -->
<!-- knitr::kable(data.frame(Metrics)) -->
<!-- ``` -->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Derek Chiu, Aline Talhouk, Samuel Leung.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
